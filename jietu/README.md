# 智能截图工具

一个基于Python Flask的智能截图工具，支持全屏和窗口截图，具有现代化的Web界面和丰富的图片处理选项。

## 功能特性

### 核心功能
- 支持全屏截图
- 支持选择窗口截图
- 实时预览截图结果
- 自动保存截图历史
- 支持多种图片格式（PNG/JPEG）
- 可调节图片质量
- 历史截图管理和查看
- 自动清理过期截图

### 界面特性
- 现代化的响应式Web界面
- 实时加载动画
- 操作状态提示
- 直观的窗口选择列表
- 图片质量实时预览
- 错误提示和处理

### 图片查看功能
- 点击放大预览
- 支持鼠标拖动
- 支持键盘方向键移动
- 鼠标滚轮缩放
- 触摸屏支持
- 背景模糊效果

### 历史记录功能
- 按需加载历史记录
- 网格布局展示
- 悬停显示时间信息
- 一键关闭/展开
- 自动更新记录
- 支持历史图片预览

## 技术框架

### 后端技术
- Python 3.x
- Flask Web框架
- Win32API（窗口操作）
- Pillow（图片处理）
- PyAutoGUI（屏幕截图）
- APScheduler（任务调度）

### 前端技术
- Bootstrap 5.1.3
- jQuery 3.6.0
- Toastr（通知提示）
- Font Awesome（图标）

## 更新日志

### 2024年最新更新
1. 后端优化
   - 添加配置文件管理
   - 增加错误处理和日志记录
   - 优化图片处理逻辑
   - 改进API响应格式
   - 添加异常处理机制
   - 实现自动清理功能
   - 新增图片删除接口

2. 前端优化
   - 全新的现代化UI设计
   - 添加响应式布局
   - 优化用户交互体验
   - 增加加载动画
   - 添加操作提示
   - 优化图片预览效果
   - 添加图片拖动功能
   - 优化历史记录显示
   - 新增图片删除功能
     - 历史记录中每张图片右上角添加删除按钮
     - 图片预览时底部工具栏添加删除按钮
     - 自定义删除确认弹窗
       - 美观的动画效果
       - 清晰的警告提示
       - 模糊背景遮罩
       - 支持点击背景关闭
     - 删除后自动更新界面

3. 新增功能
   - 支持PNG/JPEG格式选择
   - 图片质量调节
   - 历史截图管理
     - 查看历史截图
     - 删除历史截图
     - 自动更新历史记录
   - 错误页面处理
   - 图片预览增强
     - 支持拖动和缩放
     - 键盘快捷操作
     - 删除功能集成
   - 自动清理机制

## 安装说明

### 环境要求
- Python 3.x
- Windows操作系统
- 管理员权限（用于窗口操作）

### 依赖安装
```bash
pip install -r requirements.txt
```

### 配置说明
1. 修改 `config.py` 中的配置项：
   - 服务器地址和端口
   - 截图保存目录
   - 默认图片格式和质量
   - 缓存配置等

### 运行方式
```bash
python jietu.py
```
访问 `http://localhost:27018` 即可使用

## 打包说明

### 使用 auto-py-to-exe 打包

1. **优化依赖**
```bash
# 安装依赖分析工具
pip install pipreqs

# 在项目目录下生成精确的requirements.txt
pipreqs . --force
```

2. **安装打包工具**
```bash
pip install auto-py-to-exe
```

3. **启动打包工具**
```bash
auto-py-to-exe
```

4. **打包配置**
   - Script Location: 选择 `jietu.py`
   - Onefile: 选择 "One File"（生成单个exe文件）
   - Console Window: 选择 "Console Based"
   - Icon: 可选择自定义图标
   - **UPX压缩配置**:
     1. 下载UPX:
        - 访问 [UPX官网](https://upx.github.io/) 或 [Github发布页](https://github.com/upx/upx/releases/latest)
        - 下载对应系统的版本（如 upx-4.1.0-win64.zip）
        - 解压到一个固定目录（如 `C:\Program Files\upx`）
     2. 在auto-py-to-exe中配置:
        - 点击 "SETTINGS" 按钮
        - 在 "UPX Directory" 中选择UPX解压目录（如 `C:\Program Files\upx`）
        - 或在 Advanced 中添加 `--upx-dir="C:\Program Files\upx"`
   - **Advanced**:
     - --clean: 清理临时文件
     - --upx-dir: UPX目录路径
     - --noupx: 如果UPX导致问题，可以禁用
   - **Hidden Imports**: 添加以下必要的导入
     ```
     win32gui
     win32con
     win32com
     pythoncom
     PIL
     flask
     ```
   - Additional Files: 添加以下文件/文件夹
     ```
     templates/
     config.py
     ```
   - **Exclude Files**: 排除不必要的文件
     ```
     *.pyc
     __pycache__
     *.log
     ```

5. **大小优化建议**
   - UPX压缩配置：
     - 默认压缩已经很好，一般不需要调整
     - 如果需要更高压缩率，可以在Advanced中添加：
       - `--upx-opts="--best"` 最佳压缩（更慢）
       - `--upx-opts="--brute"` 暴力压缩（非常慢）
   - 其他优化：
     - 使用 `--strip` 选项移除调试信息
     - 使用 `--clean` 清理临时文件
     - 排除不必要的DLL文件
     - 使用 `--upx-exclude` 排除特定文件的压缩

6. **单文件模式注意事项**
   - 首次启动会较慢（需要解压）
   - 临时文件会解压到用户临时目录
   - 确保临时目录有足够空间
   - 可能需要防病毒软件白名单
   - 如果出现问题，尝试以下方法：
     1. 禁用UPX压缩（使用 --noupx）
     2. 使用管理员权限运行
     3. 检查临时目录权限
     4. 添加防病毒软件排除

7. **推荐的依赖版本**
```txt
Flask==2.0.1
Pillow==9.5.0
PyAutoGUI==0.9.54
pywin32==306
APScheduler==3.10.1
```

## 项目结构
```
jietu/
├── jietu.py          # 主程序
├── config.py         # 配置文件
├── requirements.txt  # 依赖清单
├── README.md        # 说明文档
└── templates/       # 前端模板
    ├── index.html   # 主页面
    └── error.html   # 错误页面
```

## 使用说明

1. 启动程序后，打开浏览器访问配置的地址
2. 在下拉列表中选择要截图的窗口（留空则为全屏截图）
3. 选择期望的图片格式（PNG或JPEG）
4. 调节图片质量（对JPEG格式有效）
5. 点击"开始截图"按钮进行截图
6. 等待截图完成后会自动显示预览
7. 点击图片可以放大查看，支持拖动和缩放
8. 点击"查看历史截图"可以查看历史记录

### 快捷键
- `ESC`: 关闭预览
- `方向键`: 移动图片
- `+/-`: 放大/缩小
- `0`: 重置大小
- 鼠标滚轮: 缩放
- 鼠标拖动: 移动图片

## 注意事项

1. 程序需要管理员权限才能对某些窗口进行截图
2. 部分窗口可能因为系统限制无法截图
3. 建议定期清理截图历史，避免占用过多存储空间
4. JPEG格式的图片质量调节对PNG格式无效
5. 首次运行时会自动创建截图保存目录
6. 程序会自动清理过期和超量的截图

## 作者信息

- 作者：BNDou
- 创建日期：2024-06-26
- 最后更新：2024-12-31

## 许可证

本项目采用 GNU General Public License v3.0 (GPL 3.0) 许可证。选择 GPL 3.0 的原因：

1. **强制开源**：任何基于本项目的衍生作品都必须使用相同的许可证并开源
2. **完整保护**：要求提供完整的源代码，包括所有修改
3. **专利保护**：提供明确的专利授权，防止专利诉讼
4. **来源保护**：必须明确标注原始代码的来源和修改
5. **用户权益**：保护用户的自由使用、学习和分享的权利

### 许可证要点

- ✅ 可以自由使用、学习、分享和修改本项目
- ✅ 允许商业使用
- ✅ 可以专利使用
- ⚠️ 修改后的代码必须开源
- ⚠️ 必须包含以下内容：
  - 原始版权声明
  - 原作者信息
  - 项目源地址：[BNDou_jietu](https://github.com/BNDou/ToolsBox/tree/main/jietu)
  - 完整的源代码
  - 修改说明
  - GPL 3.0 许可证文本
- ⚠️ 衍生作品必须使用相同的 GPL 3.0 许可证
- ⚠️ 分发时必须提供源代码
- ⚠️ 不得添加额外限制
- ⚠️ 作者不承担任何软件使用产生的责任

### 使用本项目源码需要：

1. 保留所有原始版权信息
2. 注明项目的原始出处和链接
3. 公开你修改后的完整源代码
4. 使用相同的 GPL 3.0 许可证
5. 标注你的修改内容和时间
